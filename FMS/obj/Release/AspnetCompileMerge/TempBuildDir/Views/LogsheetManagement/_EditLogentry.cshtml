@model FMS.Models.tbl_log_sheets
@{
    ViewBag.Title = "Edit Duty Log Sheet";
 }

    <div class="clsmodalheader"> Edit Duty Log Sheet</div>
    <link href="../../Content/SecurityGuard/commonstyles.css" rel="stylesheet" type="text/css" />
    <script src="../../Scripts/jquery-ui-1.8.11.js" type="text/javascript"></script>
    <style type="text/css">
    .txtAutoComplete
    {
        width: 220px !important;
        background: #FFB;
        border: 1px #cccccc solid;
        border-radius: 5px;
        -moz-border-radius: 5px;
        -webkit-border-radius: 5px;
         maxlength="30";
    }
    .txtInput
    {
    	 width: 220px !important;
    	  border-radius: 5px;
        -moz-border-radius: 5px;
        -webkit-border-radius: 5px;
    }
    .txtInputtime
    {
    	 width: 71px !important;
    	  border-radius: 5px;
        -moz-border-radius: 5px;
        -webkit-border-radius: 5px;
    }
    .ac_loading {
			background: white url("../../Content/images/loading-icon.gif") right center no-repeat;
        }
  #btnSaveAllLogentries:focus {
    border:yellow 2px solid;
    background-color:#0A99D1;
}
</style>


@using (Html.BeginForm("Edit", "LogsheetManagement", FormMethod.Post, new { id = "editfrmLogSheet", enctype = "multipart/form-data" }))
{
    @Html.ValidationSummary(true)
    <div style="overflow: auto; z-index: 9999; height: 500px;" id="divEditDutylog">
        <table class="table-striped table-condensed dTableR dataTable">
            <tr>
                <td colspan="5" style="padding-top:10px;">
                    <span id="SpanValidateMsg" style="color: Red; display: none; font-weight: bold;font-size:14px;">
                    </span>
                    <p style="color: Red; font-style: italic;">
                        @(ViewBag.message)
                    </p>
                </td>
            </tr>
            <tr>
                <td>
                    Client Name <span style="color: Red;">*</span>
                    <input type="hidden" id="cid" name="cid" />
                    <input type="hidden" id="vid" name="vid" />
                     <input type="hidden" id="eid" name="eid" />
                    <input type="hidden" id="hdnID" name="hdnID" value="@Model.ID" />
                    <input type="hidden" id="hdnLocation" name="hdnLocation" value="@Model.Location" />
                    <input type="hidden" id="hdnTripType" name="hdnTripType" value="@Model.TripeType" />
                    <input type="hidden" id="hdnVehicleID" name="hdnVehicleID" value="@Model.VehicleID" />
                    <input type="hidden" id="hdnClientID" name="hdnClientID" value="@Model.ClientID" />
                    <input type="hidden" id="hdnVehicleRegNum" name="hdnVehicleRegNum" value="@ViewBag.VehicleRegNum" />
                    <input type="hidden" id="hdnClientName" name="hdnClientName" value="@ViewBag.ClientName" />
                    <input type="hidden" id="hdnBillType" name="hdnBillType"/>
                   
                </td>
                <td>
                    @Html.TextBoxFor(model => model.ClientID, new { @class = "txtAutoComplete", @tabindex = 1 })
                </td>
            </tr>
            <tr>
                <td>
                    Veh. Reg# <span style="color: Red;">*</span>
                </td>
                <td>
                    @Html.TextBoxFor(model => model.VehicleID, new { @class = "txtAutoComplete", @tabindex = 2 })
                </td>
            </tr>
            <tr>
                <td>
                    Driver <span style="color: Red;">*</span>
                </td>
                <td>
                    <select id="DriverID" name="DriverID" class="txtInput" tabindex="3">
                        <option value="0">--Select Driver--</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    Veh. Type <span style="color: Red;">*</span>
                </td>
                <td>
                    @Html.DropDownList("VehicleTypeID", null, "--Select Vehicle Type--", new { @class = "txtInput", @tabindex = 4 })
                </td>
            </tr>
            <tr>
                <td>
                    Veh. Model <span style="color: Red;">*</span>
                </td>
                <td>
                    <select id="VehicleModelID" name="VehicleModelID" class="txtInput" tabindex="5">
                        <option value="0">--Select Model--</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    Trip Type <span style="color: Red;">*</span>
                </td>
                <td>
                    <select id="TripeType" name="TripeType" class="txtInput" tabindex="6">
                        <option value="">--Select Trip Type--</option>
                        <option value="PICKUP">PICK UP</option>
                        <option value="DROP">DROP</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    Date<span style="color: Red;">*</span>
                </td>
                <td>
                    @Html.TextBox("LogDate", String.Format("{0:dd/MM/yyyy}", Model.LogDate), new { @class = "txtInput", @tabindex = 7 })
                </td>
            </tr>
            <tr>
                <td>
                    Log Sheet# <span style="color: Red;">*</span>
                </td>
                <td>
                    @Html.TextBoxFor(model => model.LogSheetNum, new { @class = "txtInput", @tabindex = 8 })
                </td>
            </tr>
            <tr>
                <td>
                   Actual PAX
                </td>
                <td>
                    @Html.TextBoxFor(model => model.Pax, new { @class = "txtInput isNumeric", @tabindex = 9 })
                </td>
            </tr>
             <tr>
            <td>
                Travel PAX 
            </td>
            <td>
                @Html.TextBoxFor(model => model.TravelPax, new { @class = "txtInput isNumeric", @tabindex = 10 })
            </td>
        </tr>
            <tr>
                <td>
                    Login/Logout Time <span style="color: Red;">*</span>
                </td>
                <td>
                    @Html.TextBoxFor(model => model.ShiftTime, new { @class = "txtInputtime", @tabindex = 11 })
                </td>
            </tr>
             <tr>
                <td>
                    Passenger Emp#
                </td>
                <td>
                    @Html.TextBoxFor(model => model.PassengerEmpID, new { @class = "txtInput", @tabindex = 12 })
                </td>
            </tr>
            <tr>
                <td>
                    Pickup/Drop Location <span style="color: Red;">*</span>
                </td>
                <td>
                    <select id="Location" name="Location" class="txtInput" tabindex="13">
                        <option value="0">--Select Location--</option>
                    </select>
                </td>
            </tr>
            <tr>
            <td>
                Full Location 
            </td>
            <td>
               @Html.TextBoxFor(model => model.FullLocation, new { @class = "txtInput" , @tabindex = 14 })
            </td>
            </tr>
            <tr>
                <td>
                    Start KM
                </td>
                <td>
                    @Html.TextBoxFor(model => model.StartKM, new { @class = "txtInput km", @tabindex = 15 })
                </td>
            </tr>
            <tr>
                <td>
                    End KM
                </td>
                <td>
                    @Html.TextBoxFor(model => model.EndKM, new { @class = "txtInput km", @tabindex = 16 })
                </td>
            </tr>
            <tr>
                <td>
                    Total KM
                </td>
                <td>
                    @Html.TextBoxFor(model => model.TotalKM, new { @class = "txtInput", @readonly = "readonly", @style = "background-color:#EEE" })
                </td>
            </tr>
            <tr>
                <td>
                    Approved KM
                </td>
                <td>
                    @Html.TextBoxFor(model => model.Approved, new { @class = "txtInput isNumeric", @tabindex = 17, @readonly = "readonly", @style = "background-color:#EEE" })
                </td>
            </tr>
            <tr>
                <td>
                    Final Approved KM
                </td>
                <td>
                    @Html.TextBoxFor(model => model.FinalApprovedKM, new { @class = "txtInput isNumeric", @tabindex = 18 })
                </td>
            </tr>
            <tr id="tr_slabrate">
                <td>
                    SLAB Rate
                </td>
                <td>
                    @Html.TextBoxFor(model => model.SlabRate, new { @class = "txtInput", @readonly = true, @style = "background-color:#EEE" })
                </td>
            </tr>
            <tr id="tr_slabrate1">
                <td>
                    Final SLAB Rate
                </td>
                <td>
                    @Html.TextBoxFor(model => model.FinalSlabRate, new { @class = "txtInput", @tabindex = 19 })
                </td>
            </tr>
            <tr>
                <td>
                    Cash
                </td>
                <td>
                    @Html.CheckBox("IsCash", Model.IsCash == null ? false : (bool)Model.IsCash, new { @tabindex = 20 })
                </td>
            </tr>
            <tr>
                <td>
                    Remark
                </td>
                <td>
                    @Html.TextAreaFor(model => model.Remark, new { @cols = 36, @class = "txtInput", @tabindex = 21 })
                </td>
            </tr>
            <tr>
                <td>
                </td>
                <td>
                    <input type="button" id="btnSaveAllLogentries" value="Save" tabindex="21" style="cursor: pointer;
                        background-color: #0086DF; padding: 5px; color: #fff;" />
                </td>
            </tr>
        </table>
    </div>
}
<script src="../../Scripts/jquery.autocomplete.js" type="text/javascript"></script>
<script type="text/javascript" language="javascript">
    $("#div_loading").hide();
    $("#div_loading").fadeOut('slow');
   // $(document).ready(function () {
        var ID = $("#hdnID").val();
        var VehicleID = $("#hdnVehicleID").val();
        var TripType = $("#hdnTripType").val();
        var Location = $("#hdnLocation").val();
        var VehicleRegNum = $("#hdnVehicleRegNum").val();
        var ClientName = $("#hdnClientName").val();
        $("#ClientID").autocomplete("/LogsheetManagement/getAjaxResult/", { minChars: 2, matchContains: true, onItemSelect: selectItem });
        $("#VehicleID").autocomplete("/LogsheetManagement/getVehicleAjaxResult/", { minChars: 2, matchContains: true, onItemSelect: OnselectItem });
        $("#PassengerEmpID").autocomplete("/LogsheetManagement/getEmployeeAjaxResult", { minChars: 2, matchContains: true, onItemSelect: OnselectEmpItem });
        $('#cid').val('@Model.ClientID');
        $('#vid').val('@Model.VehicleID');

        $("#VehicleID").val(VehicleRegNum);
        $("#ClientID").val(ClientName);

      
        $("#TripeType option[value=" + TripType + "]").attr("selected", "selected");
        //$("#Location option[value=" + Location + "]").attr("selected", "selected");

        GetCurrentVehicleDriver('@Model.VehicleID', '@Model.ID');
        GetCurrentClientLocation('@Model.ClientID', '@Model.ID');
        GetCurrentSLABRate('@Model.ID', '@Model.ClientID');
        GetCurrentVehicleModel('@Model.VehicleID', '@Model.ID')
        $("#div_loading").hide();
        $("#div_loading").fadeOut('slow');

       // $("#Approved").focusout(function () {
       //     $('input[tabindex="1"]').focus();
       //  });
        var myDate = new Date();
        var dd = myDate.getDate();
        var mm = myDate.getMonth() + 1; //January is 0! 
        var yyyy = myDate.getFullYear();
        if (dd < 10) { dd = '0' + dd }
        if (mm < 10) { mm = '0' + mm }
        var prettyDate = dd + '/' + (mm) + '/' + yyyy;
        $("#ClientID").focus();
        $('#LogDate').datepicker({
            changeMonth: true,
            changeYear: true,
            dateFormat: 'dd/mm/yy',
            maxDate: prettyDate,
            onSelect: function () {
                $('input[tabindex="7"]').focus();
            }
        });

  //});



    function selectItem(li) {
        $('#cid').val(0);
        if (li == null) $('#cid').val(0);
        if (!!li.extra) {
            var sValue = li.extra[0];
            GetClientLocation(sValue);
            GetBillTypeByClient(sValue);
        }
        else var sValue = li.selectValue;

        $('#cid').val(sValue);
        $('input[tabindex="2"]').focus();
    }
    function OnselectItem(li) {
        $('#vid').val(0);
        if (li == null) $('#vid').val(0);
        if (!!li.extra) {
            var sValue = li.extra[0];
            GetVehicleDriver(sValue);
            GetVehicleModel(sValue);
        }
        else var sValue = li.selectValue;
        $('#vid').val(sValue);
        $('input[tabindex="3"]').focus();
    }
    function OnselectEmpItem(li) {
        $('#eid').val(0);
        if (li == null) $('#eid').val(0);
        if (!!li.extra) {
            var sValue = li.extra[0];
            GetClientLocationByEmployee(sValue);
           // LoadSLABRateByEmpID(sValue);
        }
        else var sValue = li.selectValue;
        $('#eid').val(sValue);
    }

    function GetBillTypeByClient(ClientID) {
        $.ajax({

            type: "GET",
            contentType: "application/json; charset=utf-8",
            url: "/LogsheetManagement/GetBillTypeByClient?ClientID=" + ClientID + "",
            dataType: "json",
            success: function (data) {
                var res = data.BillTypeID;
                $('#hdnBillType').val(res);
                
                if ((res == "TRIPS")) {
                    $("#tr_slabrate").show();$("#tr_slabrate1").show();
                }
                else if (res == "KILO METER") {
                    $("#tr_slabrate").hide(); $("#tr_slabrate1").hide();
                }
            },
            error: function (error) {
                // alert(error);
            }
        });
    } 
    function GetCurrentSLABRate(ID, ClientID) {

        $.ajax({
            type: "GET",
            contentType: "application/json; charset=utf-8",
            url: "/LogsheetManagement/GetBillTypeByClient?ClientID=" + ClientID + "",
            dataType: "json",
            success: function (data) {
                var res = data.BillTypeID;
                if ((res == "TRIPS")) { //Client has bill type SLAB
                    $("#tr_slabrate").show();$("#tr_slabrate1").show();
                     $.ajax({
                        type: "GET",
                        contentType: "application/json; charset=utf-8",
                        url: "/LogsheetManagement/GetCurrentSLABRate?ID=" + ID + "",
                        dataType: "json",
                        success: function (data) {
                            $("#SlabRate").val(data.SLABRate);
                        },
                        error: function (error) {
                            // alert(error);
                        }
                    });
                }
                else {
                    $("#tr_slabrate").hide(); $("#tr_slabrate1").hide();

                }
            },
            error: function (error) {
                // alert(error);
            }
        });
    }
    function LoadSLABRateByEmpID(ID) {
        var ClientID = $("#cid").val();
        var Location = $("#Location").val();

        $.ajax({
            type: "GET",
            contentType: "application/json; charset=utf-8",
            url: "/LogsheetManagement/LoadSlabRateByEmpID?Location=" + Location + "&ClientID=" + ClientID + "&EmpId=" + ID,
            dataType: "json",
            success: function (data) {
                $("#SlabRate").val(data.VendorRate);
            },
            error: function (error) {
                // alert(error);
            }
        });
    }
    $('#Location').change(function () {
        var billType = $('#hdnBillType').val();
        var ClientID = $("#cid").val();
        var VehicleID = $("#vid").val();
        var EmployeeID = $("#eid").val();
        var VehicleTypeID = $("#VehicleTypeID").val();
        if ($(this).val() == 0) {
            $("#SpanValidateMsg").show();
            $("#SpanValidateMsg").html('Please select location');
            $("#Location").focus();
            return false;
        }
        else if (EmployeeID == "") {
            $("#SpanValidateMsg").hide();
            if (billType == "TRIPS") {
                LoadSlabRateByLocation($(this).val(), ClientID, VehicleID, VehicleTypeID);
            }
            else {
                // Load Kilo Meter By Location
                LoadApprovedKMByLocation($(this).val(), ClientID, VehicleID);
            }
        }
        else {
            $("#SpanValidateMsg").hide();
            if (billType == "TRIPS") {
                LoadSlabRateByEmployee($(this).val(), ClientID, VehicleID, EmployeeID, VehicleTypeID);
            }
            else {
                // Load Kilo Meter By Location
                LoadApprovedKMByLocation($(this).val(), ClientID, VehicleID);
            }
        }
    });
    $('#VehicleTypeID').change(function () {
        var ClientID = $("#cid").val();
        var VehicleID = $("#vid").val();
        var EmployeeID = $("#eid").val();
        var Location = $("#Location").val();
        if ($(this).val() == 0) {
            $("#SpanValidateMsg").show();
            $("#SpanValidateMsg").html('Please select vehicle type');
            $("#Location").focus();
            return false;
        }
        else if (EmployeeID == "" && Location == "") {
            $("#SpanValidateMsg").hide();
        }
        else if (EmployeeID != "") {
            $("#SpanValidateMsg").hide();
            LoadSlabRateByEmployee(Location, ClientID, VehicleID, EmployeeID, $(this).val());
        }
        else if (EmployeeID == "") {
            $("#SpanValidateMsg").hide();
            LoadSlabRateByLocation(Location, ClientID, VehicleID, $(this).val());
        }
    });
    function LoadApprovedKMByLocation(Location, ClientID, VehicleID) {
        $.ajax({
            type: "GET",
            contentType: "application/json; charset=utf-8",
            url: "/LogsheetManagement/LoadApprovedKMByLocation?Location=" + Location + "&ClientID=" + ClientID + "&VehicleID=" + VehicleID,
            dataType: "json",
            success: function (data) {
                $("#Approved").val(data.ApprovedKM);
            },
            error: function (error) {
                // alert(error);
            }
        });
    }
    function LoadSlabRateByLocation(Location, ClientID, VehicleID, VehicleTypeID) {
        $.ajax({
            type: "GET",
            contentType: "application/json; charset=utf-8",
            url: "/LogsheetManagement/LoadSlabRateByLocation?Location=" + Location + "&ClientID=" + ClientID + "&VehicleID=" + VehicleID + "&VehicleTypeID=" + VehicleTypeID,
            dataType: "json",
            success: function (data) {
                $("#SlabRate").val(data.VendorRate);
            },
            error: function (error) {
                // alert(error);
            }
        });
    }
    function LoadSlabRateByEmployee(Location, ClientID, VehicleID, EmployeeID, VehicleTypeID) {
        $.ajax({
            type: "GET",
            contentType: "application/json; charset=utf-8",
            url: "/LogsheetManagement/LoadSlabRateByEmployee?Location=" + Location + "&ClientID=" + ClientID + "&VehicleID=" + VehicleID + "&EmployeeID=" + EmployeeID + "&VehicleTypeID=" + VehicleTypeID,
            dataType: "json",
            success: function (data) {
                $("#SlabRate").val(data.VendorRate);
            },
            error: function (error) {
                // alert(error);
            }
        });
    }
    function GetClientLocation(ClientID) {
        $("#div_loading").fadeIn('slow');
        $.ajax({
            type: "GET",
            contentType: "application/json; charset=utf-8",
            url: "/LogsheetManagement/GetLoaction?ClientID=" + ClientID + "",
            dataType: "json",
            success: function (data) {

                if (data.length > 0) {
                    $('#Location').html('<option value="0">--Select Location--</option>');
                    var options = ""; var sModel = "";
                    for (var i = 0; i < data.length; ++i) {
                        options += "<option value='" + data[i].Text1 + "'>" + data[i].Text2 + "</option>";
                        sModel = data[i].ID;
                    }
                    $("#Location").append(options);
                    //  $("#Location option[value=" + sModel + "]").attr("selected", "selected");
                    $('#Location option:contains("Loading...")').remove();
                    $("#div_loading").fadeOut('slow');
                }
                else {
                    $('#Location').html('<option value="0">--Select Location--</option>');
                    var options = ""; var sModel = "";
                    if (data.length > 0) {
                        for (var i = 0; i < data.length; ++i) {
                            options += "<option value='" + data[i].Text1 + "'>" + data[i].Text2 + "</option>";
                            sModel = data[i].ID;
                        }
                        $("#Location").append(options);
                    }
                    $("#div_loading").fadeOut('slow');
                }
            },
            error: function (error) {
                // alert(error);
            }
        });
    }
    function GetClientLocationByEmployee(EmployeeID) {
        $("#divlog_loading").fadeIn('slow');
        var ClientID = $("#cid").val();
        var VehicleID = $("#vid").val();
        var VehicleTypeID = $("#VehicleTypeID").val();
        $.ajax({
            type: "GET",
            contentType: "application/json; charset=utf-8",
            url: "/LogsheetManagement/GetLoactionByEmployee?ClientID=" + ClientID + "&EmployeeID=" + EmployeeID,
            dataType: "json",
            success: function (data) {

                if (data.length > 0) {
                    $('#Location').html('<option value="0">--Select Location--</option>');
                    var options = ""; var sModel = "";
                    for (var i = 0; i < data.length; ++i) {
                        options += "<option value='" + data[i].Text1 + "'>" + data[i].Text2 + "</option>";
                        sModel = data[i].Text1;
                    }
                    $("#Location").append(options);
                    $("#Location option[value=" + sModel + "]").attr("selected", "selected");
                    LoadSlabRateByEmployee(sModel, ClientID, VehicleID, EmployeeID, VehicleTypeID);
                    $('#Location option:contains("Loading...")').remove();
                    $("#divlog_loading").fadeOut('slow');
                }
                else {
                    $('#Location').html('<option value="0">--Select Location--</option>');
                    var options = ""; var sModel = "";
                    if (data.length > 0) {
                        for (var i = 0; i < data.length; ++i) {
                            options += "<option value='" + data[i].Text1 + "'>" + data[i].Text2 + "</option>";
                            sModel = data[i].Text1;
                        }
                        $("#Location").append(options);
                        $("#Location option[value=" + sModel + "]").attr("selected", "selected");
                        LoadSlabRateByEmployee(sModel, ClientID, VehicleID, EmployeeID, VehicleTypeID);
                    }
                    $("#divlog_loading").fadeOut('slow');
                }
            },
            error: function (error) {
                // alert(error);
            }
        });
    }

    function GetVehicleDriver(VehicleID) {
        $("#div_loading").fadeIn('slow');
        $.ajax({
            type: "GET",
            contentType: "application/json; charset=utf-8",
            url: "/LogsheetManagement/GetVehicleDriver?VehicleID=" + VehicleID + "",
            dataType: "json",
            success: function (data) {

                if (data.length > 0) {
                    $('#DriverID').html('<option value="">--Select Driver--</option>');
                    var options = ""; var sModel = "";
                    for (var i = 0; i < data.length; ++i) {
                        options += "<option value='" + data[i].ID + "'>" + data[i].FirstName + " " + data[i].LastName + "</option>";
                        sModel = data[i].ID;
                    }
                    $("#DriverID").append(options);
                    $("#DriverID option[value=" + sModel + "]").attr("selected", "selected");
                    $('#DriverID option:contains("Loading...")').remove();
                    $("#div_loading").fadeOut('slow');
                }
                else {
                    $('#DriverID').html('<option value="">--Select Driver--</option>');
                    var options = ""; var sModel = "";
                    if (data.length > 0) {
                        for (var i = 0; i < data.length; ++i) {
                            options += "<option value='" + data[i].ID + "'>" + data[i].FirstName + " " + data[i].LastName + "</option>";
                            sModel = data[i].ID;
                        }
                        $("#DriverID").append(options);
                        $("#DriverID option[value=" + sModel + "]").attr("selected", "selected");

                    }
                    $("#div_loading").fadeOut('slow');
                }
            },
            error: function (error) {
                // alert(error);
            }
        });
    }

    function GetCurrentVehicleDriver(VehicleID, ID) {
        $("#div_loading").fadeIn('slow');
        $.ajax({
            type: "GET",
            contentType: "application/json; charset=utf-8",
            url: "/LogsheetManagement/GetCurrentVehicleDriver?VehicleID=" + VehicleID + "&ID=" + ID,
            dataType: "json",
            success: function (data) {

                if (data.length > 0) {
                    $('#DriverID').html('<option value="">--Select Driver--</option>');
                    var options = ""; var sModel = "";
                    for (var i = 0; i < data.length; ++i) {
                        options += "<option value='" + data[i].ID + "'>" + data[i].FirstName + " " + data[i].LastName + "</option>";
                        sModel = data[i].ID;
                    }
                    $("#DriverID").append(options);
                    $("#DriverID option[value=" + sModel + "]").attr("selected", "selected");
                    $('#DriverID option:contains("Loading...")').remove();
                    $("#div_loading").fadeOut('slow');
                }
                else {
                    $('#DriverID').html('<option value="">--Select Driver--</option>');
                    var options = ""; var sModel = "";
                    if (data.length > 0) {
                        for (var i = 0; i < data.length; ++i) {
                            options += "<option value='" + data[i].ID + "'>" + data[i].FirstName + " " + data[i].LastName + "</option>";
                            sModel = data[i].ID;
                        }
                        $("#DriverID").append(options);
                        $("#DriverID option[value=" + sModel + "]").attr("selected", "selected");

                    }
                    $("#div_loading").fadeOut('slow');
                }
            },
            error: function (error) {
                // alert(error);
            }
        });
    }
    function GetVehicleModel(VehicleID) {
        $("#divlog_loading").fadeIn('slow');
        $.ajax({
            type: "GET",
            contentType: "application/json; charset=utf-8",
            url: "/LogsheetManagement/GetVehicleModel?VehicleID=" + VehicleID + "",
            dataType: "json",
            success: function (data) {

                if (data.length > 0) {
                    $('#VehicleModelID').html('<option value="">--Select Model--</option>');
                    var options = ""; var sModel = "";
                    for (var i = 0; i < data.length; ++i) {
                        options += "<option value='" + data[i].ID + "'>" + data[i].VehicleModelName + "</option>";
                        sModel = data[i].ID;
                    }
                    $("#VehicleModelID").append(options);
                    $("#VehicleModelID option[value=" + sModel + "]").attr("selected", "selected");
                    $('#VehicleModelID option:contains("Loading...")').remove();
                    $("#divlog_loading").fadeOut('slow');
                }
                else {
                    $('#VehicleModelID').html('<option value="">--Select Model--</option>');
                    $("#divlog_loading").fadeOut('slow');
                }
            },
            error: function (error) {
                // alert(error);
            }
        });
    }
    function GetCurrentVehicleModel(VehicleID, ID) {
        $.ajax({
            type: "GET",
            contentType: "application/json; charset=utf-8",
            url: "/LogsheetManagement/GetCurrentVehicleModel?VehicleID=" + VehicleID + "&ID=" + ID,
            dataType: "json",
            success: function (data) {

                if (data.length > 0) {
                    $('#VehicleModelID').html('<option value="">--Select Model--</option>');
                    var options = ""; var sModel = "";
                    for (var i = 0; i < data.length; ++i) {
                        options += "<option value='" + data[i].ID + "'>" + data[i].VehicleModelName + "</option>";
                        sModel = data[i].ID;
                    }
                    $("#VehicleModelID").append(options);
                    $("#VehicleModelID option[value=" + sModel + "]").attr("selected", "selected");
                    $("#divlog_loading").fadeOut('slow');
                    $('#VehicleModelID option:contains("Loading...")').remove();
                }
                else {
                    $('#VehicleModelID').html('<option value="">--Select Model--</option>');
                    $("#divlog_loading").fadeOut('slow');
                }
            },
            error: function (error) {
                // alert(error);
            }
        });
    }
    function GetCurrentClientLocation(ClientID, ID) {
        $("#div_loading").fadeIn('slow');
        $.ajax({
            type: "GET",
            contentType: "application/json; charset=utf-8",
            url: "/LogsheetManagement/GetCurrentClientLocation?ClientID=" + ClientID + "&ID=" + ID,
            dataType: "json",
            success: function (data) {
                if (data.length > 0) {
                   // $('#Location').html('<option value="">--Select Location--</option>');
                    var options = ""; var sModel = "";
                    for (var i = 0; i < data.length; ++i) {
                        options += "<option value='" + data[i].Location + "'>" + data[i].Location + "</option>";
                        sModel = data[i].Location;
                    }
                    $("#Location").append(options);
                    $("#Location option[value='" + sModel + "']").attr("selected", "selected");
                    $('#Location option:contains("Loading...")').remove();
                    $("#div_loading").fadeOut('slow');
                }
                else {
                  //  $('#Location').html('<option value="">--Select Location--</option>');
                    var options = ""; var sModel = "";
                    if (data.length > 0) {
                        for (var i = 0; i < data.length; ++i) {
                            options += "<option value='" + data[i].Location + "'>" + data[i].Location + "</option>";
                            sModel = data[i].Location;
                        }
                        $("#Location").append(options);
                        $("#Location option[value='" + sModel + "']").attr("selected", "selected");

                    }
                    $("#div_loading").fadeOut('slow');
                }
            },
            error: function (error) {
                // alert(error);
            }
        });
    }
    //Caliculate total kilometeres
    $(".km").change(function () {
        var KMID = this.id;
        var result = isNumeric(this.value);
        if (KMID == "StartKM") {
            var EndKM = $("#EndKM").val();
            var StartKM = $("#StartKM").val();
            if (EndKM != "") {
                if (parseInt(EndKM) == parseInt(StartKM)) {
                    $("#SpanValidateMsg").show();
                    $("#SpanValidateMsg").html("Starting KM and Ending KM can not be same!");
                    $(this).val('');
                    $("#TotalKM").val('');
                    $(this).focus();
                    $('#divEditDutylog').animate({ scrollTop: 0 }, 'slow');
                }
                else {
                    if (parseInt(EndKM) > parseInt(StartKM)) {
                        var TotalKM = (EndKM - StartKM)
                        $("#TotalKM").val(TotalKM);
                        $("#SpanValidateMsg").hide();
                    }
                    else if (result == false) {
                        $("#SpanValidateMsg").show();
                        $("#SpanValidateMsg").text("Please enter numerics only.");
                        document.getElementById("" + this.id + "").value = '';
                        $(this).focus();
                        $("#TotalKM").val('');
                        $('#divEditDutylog').animate({ scrollTop: 0 }, 'slow');
                    }
                    else {
                        $("#SpanValidateMsg").show();
                        $("#SpanValidateMsg").html("You can't enter more than " + EndKM + "  Kilometres");
                        $(this).val('');
                        $(this).focus();
                        $("#TotalKM").val('');
                        $('#divEditDutylog').animate({ scrollTop: 0 }, 'slow');
                    }
                }
            }
            else {
                if (result == false) {
                    $("#SpanValidateMsg").show();
                    $("#SpanValidateMsg").text("Please enter numerics only.");
                    document.getElementById("" + this.id + "").value = '';
                    $('#divEditDutylog').animate({ scrollTop: 0 }, 'slow');
                }
                $(this).focus();
                $("#EndKM").val('');
                $("#TotalKM").val('');
            }
        }
        else {
            var StartKM = $("#StartKM").val();
            var EndKM = $("#EndKM").val();
            if (parseInt(EndKM) == parseInt(StartKM)) {
                $("#SpanValidateMsg").show();
                $("#SpanValidateMsg").html("Starting KM and Ending KM can not be same!");
                $(this).val('');
                $("#TotalKM").val('');
                $(this).focus();
                $('#divEditDutylog').animate({ scrollTop: 0 }, 'slow');
            }
            else {
                if (StartKM != "") {
                    if (parseInt(EndKM) > parseInt(StartKM)) {
                        var TotalKM = (EndKM - StartKM)
                        $("#TotalKM").val(TotalKM);
                        $("#SpanValidateMsg").hide();
                    }
                    else if (result == false) {
                        $("#SpanValidateMsg").show();
                        $("#SpanValidateMsg").text("Please enter numerics only.");
                        document.getElementById("" + this.id + "").value = '';
                        $(this).focus();
                        $("#TotalKM").val('');
                        $('#divEditDutylog').animate({ scrollTop: 0 }, 'slow');
                    }
                    else {
                        $("#SpanValidateMsg").show();
                        $("#SpanValidateMsg").html("You can't enter less than " + StartKM + "  Kilometres");
                        $(this).val('');
                        $(this).focus();
                        $("#TotalKM").val('');
                        $('#divEditDutylog').animate({ scrollTop: 0 }, 'slow');
                    }
                }
                else {
                    $("#SpanValidateMsg").show();
                    $("#SpanValidateMsg").html("Please enter start Kilometres");
                    $(this).val('');
                    $(this).focus();
                    $("#TotalKM").val('');
                    $('#divEditDutylog').animate({ scrollTop: 0 }, 'slow');
                }
            }
        }
    }); 
   
    $(".isNumeric").change(function () {
        var KMID = this.id;
        var title = isNumeric(this.value);
        if (title == false) {
            $("#SpanValidateMsg").show();
            $("#SpanValidateMsg").text("Please enter numerics only.");
            document.getElementById("" + this.id + "").value = '';
            $('#divEditDutylog').animate({ scrollTop: 0 }, 'slow');
        }
        else {
            $("#SpanValidateMsg").hide();
        }
    });
    $("#LogDate").change(function () {
        $("#SpanValidateMsg").hide();
        var dateval = $("#" + this.id).val();
        var msg = validateDate(dateval);
        if (msg != "") {
            document.getElementById("" + this.id + "").value = '';
            this.focus();
            $("#SpanValidateMsg").show();
            $("#SpanValidateMsg").html(msg);
            $('#divEditDutylog').animate({ scrollTop: 0 }, 'slow');
            return false;
        }

    });
    $("#LogSheetNum").change(function () {
        $("#SpanValidateMsg").hide();
        var result = isPureAlphaNumeric(this.value);
        if (result == false) {
            document.getElementById("" + this.id + "").value = '';
            this.focus();
            $("#SpanValidateMsg").show();
            $("#SpanValidateMsg").html("Log sheet number should be numeric.");
            $('#divEditDutylog').animate({ scrollTop: 0 }, 'slow');
            return false;
        }
        $.post('/LogSheetManagement/VerifyLogSheetNumber?logsheetnum=' + this.value, function (data) {
            if (data == 'False') {
                document.getElementById('LogSheetNum').value = '';
                document.getElementById('LogSheetNum').focus();
                $("#SpanValidateMsg").show();
                $("#SpanValidateMsg").html("Log sheet number already exists.");
                $('#divNewDutylog').animate({ scrollTop: 0 }, 'slow');
                return false;
            }

        });

    });
   

    $("#btnSaveAllLogentries").click(function () {

        if (!ValidateMsg()) {
            $('#divEditDutylog').animate({ scrollTop: 0 }, 'slow');
            return;
        }

        // Call Ajax Post Method Here 
        var ID = '@Model.ID';
        var ClientID = $("#cid").val();
        var frmColl = $("#editfrmLogSheet").serialize();
        $("#div_loading").show();
        $("#div_loading").fadeIn('slow');
      
        $.ajax(
              {
                  type: "POST",
                  url: "../LogsheetManagement/Edit",
                  dataType: "html",
                  data: "Id=" + ID + "&ClientID=" + ClientID + "&frm=" + frmColl,
                  success: function (result, textStatus, jqXHR) {
                      $('#divSimpleModalDet').html('');
                      $('#divSimpleModalDet').html(result);
                  },
                  error: function (error) {
                      // alert(error);
                  }
              });
    });

    function ClearAll() {

        $("#cid").val('');
        $("#vid").val('');
        $("#ClientID").val('');
        $("#VehicleID").val('');

        $("#DriverID").val('');
        $("#VehicleTypeID").val('');
        $("#TripeType").val('');
        $("#LogDate").val('');

        $("#LogSheetNum").val('');
        $("#Pax").val('');
        $("#ShiftTime").val('');

        $("#Location").val('');
        $("#StartKM").val('');

        $("#EndKM").val('');
        $("#TotalKM").val('');
        $("#Approved").val('');
        $('#Remark').val('');
        $("#PassengerEmpID").val('');

    }
    // Validate Fields
    function ValidateMsg() {
//        var ClientID = $("#cid").val();
//        var VehicleID = $("#vid").val();

        var txtClient = $("#ClientID").val();
        var txtVehicleRegNo = $("#VehicleID").val();
        var ddVehicleDriver = $("#DriverID").val();
        var ddVehicleType = $("#VehicleTypeID").val();
        var ddVehicleModel = $("#VehicleModelID").val();

        var ddTriptype = $("#TripeType").val();
        var txtDate = $("#LogDate").val();

        var txtLogSNo = $("#LogSheetNum").val();
        var txtPax = $("#Pax").val();
        var txtShiftTime = $("#ShiftTime").val();

        var Location = $("#Location").val();
        var txtStartKM = $("#StartKM").val();

        var txtEndKM = $("#EndKM").val();
        var txtTotalKM = $("#TotalKM").val();
        var txtApprovKM = $("#Approved").val();
        var txtEmpID = $("#PassengerEmpID").val();


        if (txtClient == "") {
            $("#SpanValidateMsg").show();
            $("#SpanValidateMsg").html('Please search client name');
            $("#ClientID").focus();
            return false;
        }
        if (txtVehicleRegNo == "") {
            $("#SpanValidateMsg").show();
            $("#SpanValidateMsg").html('Please search vehicle reg number');
            $("#VehicleID").focus();
            return false;
        }

        if (ddVehicleDriver == "") {
            $("#SpanValidateMsg").show();
            $("#SpanValidateMsg").html('Please select Driver.');
            $("#DriverID").focus();
            return false;
        }
        if (ddVehicleType == "") {
            $("#SpanValidateMsg").show();
            $("#SpanValidateMsg").html('Please select vehicle type.');
            $("#VehicleTypeID").focus();
            return false;
        }
        if (ddVehicleModel == "") {
            $("#SpanValidateMsg").show();
            $("#SpanValidateMsg").html('Please select vehicle model.');
            $("#VehicleModelID").focus();
            return false;
        }
        if (ddTriptype == "") {
            $("#SpanValidateMsg").show();
            $("#SpanValidateMsg").html('Please select trip type');
            $("#TripeType").focus();
            return false;
        }
        if (txtDate == "") {
            $("#SpanValidateMsg").show();
            $("#SpanValidateMsg").html('Please enter date');
            $("#LogDate").focus();
            return false;
        }
        if (txtLogSNo == "") {
            $("#SpanValidateMsg").show();
            $("#SpanValidateMsg").html('Please enter log sheet number');
            $("#LogSheetNum").focus();
            return false;
        }

        if (txtShiftTime == "") {
            $("#SpanValidateMsg").show();
            $("#SpanValidateMsg").html('Please enter login time');
            $("#ShiftTime").focus();
            return false;
        }
       if (Location == "") {
            $("#SpanValidateMsg").show();
            $("#SpanValidateMsg").html('Please select location');
            $("#Location").focus();
            return false;
        }
        return true;
    }
    
</script>


